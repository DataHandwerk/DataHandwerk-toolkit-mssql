/*****START OF DEBUG INFORMATION*****

The primary key column list:
[index_column_id], [index_guid]

The INSERT column list:
[index_guid],[index_column_id],[RepoObjectColumn_guid],[is_descending_key]

The UPDATE column list:
 [Target].[RepoObjectColumn_guid] = [Source].[RepoObjectColumn_guid], 
  [Target].[is_descending_key] = [Source].[is_descending_key]

The SELECT statement executed to generate the MERGE:
SELECT ' ' + CASE WHEN ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) = 1 THEN ' ' ELSE ',' END + '('+ COALESCE('N''' + REPLACE(CONVERT(char(36),RTRIM([index_guid])),'''','''''')+'''','NULL')+',' + COALESCE(LTRIM(RTRIM(CONVERT(char, [index_column_id]))),'NULL')+',' + COALESCE('N''' + REPLACE(CONVERT(char(36),RTRIM([RepoObjectColumn_guid])),'''','''''')+'''','NULL')+',' + COALESCE(LTRIM(RTRIM(CONVERT(char, [is_descending_key]))),'NULL')+')'  FROM [repo].[IndexColumn_virtual] (NOLOCK) ORDER BY [index_column_id], [index_guid]

*****END OF DEBUG INFORMATION*****/


USE [dhw_self]
GO

--MERGE generated by 'sp_generate_merge' stored procedure
--Originally by Vyas (http://vyaskn.tripod.com/code): sp_generate_inserts (build 22)
--Adapted for SQL Server 2008+ by Daniel Nolan (https://twitter.com/dnlnln)

SET NOCOUNT ON

MERGE INTO [repo].[IndexColumn_virtual] AS [Target]
USING (VALUES
  (N'8519C175-6962-EB11-84DC-A81E8446D5B0',1,N'91F77926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'8D19C175-6962-EB11-84DC-A81E8446D5B0',1,N'D9F17926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'8E19C175-6962-EB11-84DC-A81E8446D5B0',1,N'16F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'9019C175-6962-EB11-84DC-A81E8446D5B0',1,N'B6F77926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'9319C175-6962-EB11-84DC-A81E8446D5B0',1,N'7EF27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'9419C175-6962-EB11-84DC-A81E8446D5B0',1,N'F4F67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'9519C175-6962-EB11-84DC-A81E8446D5B0',1,N'86F17926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'9819C175-6962-EB11-84DC-A81E8446D5B0',1,N'87F17926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'9919C175-6962-EB11-84DC-A81E8446D5B0',1,N'36F47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'9C19C175-6962-EB11-84DC-A81E8446D5B0',1,N'30F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'9D19C175-6962-EB11-84DC-A81E8446D5B0',1,N'32F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'A019C175-6962-EB11-84DC-A81E8446D5B0',1,N'8DF47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'A319C175-6962-EB11-84DC-A81E8446D5B0',1,N'13F67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'A419C175-6962-EB11-84DC-A81E8446D5B0',1,N'0EF77926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'A619C175-6962-EB11-84DC-A81E8446D5B0',1,N'32F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'A719C175-6962-EB11-84DC-A81E8446D5B0',1,N'30F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'AD19C175-6962-EB11-84DC-A81E8446D5B0',1,N'13F67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'AE19C175-6962-EB11-84DC-A81E8446D5B0',1,N'0EF77926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'BB19C175-6962-EB11-84DC-A81E8446D5B0',1,N'2DF67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'BC19C175-6962-EB11-84DC-A81E8446D5B0',1,N'0FF77926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'C519C175-6962-EB11-84DC-A81E8446D5B0',1,N'D0F17926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'C619C175-6962-EB11-84DC-A81E8446D5B0',1,N'2FF27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'C719C175-6962-EB11-84DC-A81E8446D5B0',1,N'45F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'C819C175-6962-EB11-84DC-A81E8446D5B0',1,N'5CF27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'CA19C175-6962-EB11-84DC-A81E8446D5B0',1,N'70F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'EFCE9178-6B62-EB11-84DC-A81E8446D5B0',1,N'47F77926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'DF427A38-4265-EB11-84DD-A81E8446D5B0',1,N'217E4BE1-8F64-EB11-84DD-A81E8446D5B0',0)
 ,(N'E0427A38-4265-EB11-84DD-A81E8446D5B0',1,N'257E4BE1-8F64-EB11-84DD-A81E8446D5B0',0)
 ,(N'E3427A38-4265-EB11-84DD-A81E8446D5B0',1,N'51813EBD-7764-EB11-84DD-A81E8446D5B0',0)
 ,(N'E4427A38-4265-EB11-84DD-A81E8446D5B0',1,N'4D813EBD-7764-EB11-84DD-A81E8446D5B0',0)
 ,(N'E7427A38-4265-EB11-84DD-A81E8446D5B0',1,N'AF9FCDB3-3265-EB11-84DD-A81E8446D5B0',0)
 ,(N'EC427A38-4265-EB11-84DD-A81E8446D5B0',1,N'AD9FCDB3-3265-EB11-84DD-A81E8446D5B0',0)
 ,(N'EF427A38-4265-EB11-84DD-A81E8446D5B0',1,N'89813D1C-6662-EB11-84DC-A81E8446D5B0',0)
 ,(N'4EC2589C-5265-EB11-84DD-A81E8446D5B0',1,N'F862548B-3865-EB11-84DD-A81E8446D5B0',0)
 ,(N'166B6592-EF66-EB11-84DD-A81E8446D5B0',1,N'48C1E60F-ED66-EB11-84DD-A81E8446D5B0',0)
 ,(N'A7C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'ABF47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'A8C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'237E4BE1-8F64-EB11-84DD-A81E8446D5B0',0)
 ,(N'A9C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'89F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'ABC621A8-0867-EB11-84DD-A81E8446D5B0',1,N'B7F67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'ADC621A8-0867-EB11-84DD-A81E8446D5B0',1,N'DAF47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'AFC621A8-0867-EB11-84DD-A81E8446D5B0',1,N'B4F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'B4C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'F44A3013-3866-EB11-84DD-A81E8446D5B0',0)
 ,(N'B8C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'ED4A3013-3866-EB11-84DD-A81E8446D5B0',0)
 ,(N'BAC621A8-0867-EB11-84DD-A81E8446D5B0',1,N'4F813EBD-7764-EB11-84DD-A81E8446D5B0',0)
 ,(N'BBC621A8-0867-EB11-84DD-A81E8446D5B0',1,N'83F47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'BCC621A8-0867-EB11-84DD-A81E8446D5B0',1,N'D1F67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'BEC621A8-0867-EB11-84DD-A81E8446D5B0',1,N'B8F67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'C0C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'43F67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'C2C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'97F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'C4C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'C0F47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'C6C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'96F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'C7C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'F08F8F21-4265-EB11-84DD-A81E8446D5B0',0)
 ,(N'C8C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'F38F8F21-4265-EB11-84DD-A81E8446D5B0',0)
 ,(N'CBC621A8-0867-EB11-84DD-A81E8446D5B0',1,N'AA9FCDB3-3265-EB11-84DD-A81E8446D5B0',0)
 ,(N'CCC621A8-0867-EB11-84DD-A81E8446D5B0',1,N'F64A3013-3866-EB11-84DD-A81E8446D5B0',0)
 ,(N'CFC621A8-0867-EB11-84DD-A81E8446D5B0',1,N'B4F47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'D1C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'BFF47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'D3C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'CEF47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'D5C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'D5F17926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'D6C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'D3F17926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'D9C621A8-0867-EB11-84DD-A81E8446D5B0',1,N'D9F47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'DBC621A8-0867-EB11-84DD-A81E8446D5B0',1,N'3DF67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'DDC621A8-0867-EB11-84DD-A81E8446D5B0',1,N'34F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'DEC621A8-0867-EB11-84DD-A81E8446D5B0',1,N'37F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'ADB7BA42-0B67-EB11-84DD-A81E8446D5B0',1,N'41F77926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'432CC058-426D-EB11-84E2-A81E8446D5B0',1,N'35C1E60F-ED66-EB11-84DD-A81E8446D5B0',0)
 ,(N'442CC058-426D-EB11-84E2-A81E8446D5B0',1,N'35C1E60F-ED66-EB11-84DD-A81E8446D5B0',0)
 ,(N'9819C175-6962-EB11-84DC-A81E8446D5B0',2,N'88F17926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'9919C175-6962-EB11-84DC-A81E8446D5B0',2,N'37F47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'A619C175-6962-EB11-84DC-A81E8446D5B0',2,N'36F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'A719C175-6962-EB11-84DC-A81E8446D5B0',2,N'39F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'AD19C175-6962-EB11-84DC-A81E8446D5B0',2,N'31F67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'AE19C175-6962-EB11-84DC-A81E8446D5B0',2,N'11F77926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'BB19C175-6962-EB11-84DC-A81E8446D5B0',2,N'2FF67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'BC19C175-6962-EB11-84DC-A81E8446D5B0',2,N'10F77926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'CA19C175-6962-EB11-84DC-A81E8446D5B0',2,N'71F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'D9427A38-4265-EB11-84DD-A81E8446D5B0',2,N'227E4BE1-8F64-EB11-84DD-A81E8446D5B0',0)
 ,(N'DA427A38-4265-EB11-84DD-A81E8446D5B0',2,N'267E4BE1-8F64-EB11-84DD-A81E8446D5B0',0)
 ,(N'DB427A38-4265-EB11-84DD-A81E8446D5B0',2,N'52813EBD-7764-EB11-84DD-A81E8446D5B0',0)
 ,(N'DC427A38-4265-EB11-84DD-A81E8446D5B0',2,N'4E813EBD-7764-EB11-84DD-A81E8446D5B0',0)
 ,(N'E7427A38-4265-EB11-84DD-A81E8446D5B0',2,N'AE9FCDB3-3265-EB11-84DD-A81E8446D5B0',0)
 ,(N'4EC2589C-5265-EB11-84DD-A81E8446D5B0',2,N'FB62548B-3865-EB11-84DD-A81E8446D5B0',0)
 ,(N'166B6592-EF66-EB11-84DD-A81E8446D5B0',2,N'49C1E60F-ED66-EB11-84DD-A81E8446D5B0',0)
 ,(N'1D6B6592-EF66-EB11-84DD-A81E8446D5B0',2,N'F28F8F21-4265-EB11-84DD-A81E8446D5B0',0)
 ,(N'1E6B6592-EF66-EB11-84DD-A81E8446D5B0',2,N'F58F8F21-4265-EB11-84DD-A81E8446D5B0',0)
 ,(N'A9C621A8-0867-EB11-84DD-A81E8446D5B0',2,N'8AF27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'ADC621A8-0867-EB11-84DD-A81E8446D5B0',2,N'DBF47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'B4C621A8-0867-EB11-84DD-A81E8446D5B0',2,N'F34A3013-3866-EB11-84DD-A81E8446D5B0',0)
 ,(N'BCC621A8-0867-EB11-84DD-A81E8446D5B0',2,N'CCF67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'BEC621A8-0867-EB11-84DD-A81E8446D5B0',2,N'B9F67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'C0C621A8-0867-EB11-84DD-A81E8446D5B0',2,N'42F67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'C2C621A8-0867-EB11-84DD-A81E8446D5B0',2,N'98F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'C4C621A8-0867-EB11-84DD-A81E8446D5B0',2,N'C1F47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'C7C621A8-0867-EB11-84DD-A81E8446D5B0',2,N'F48F8F21-4265-EB11-84DD-A81E8446D5B0',0)
 ,(N'C8C621A8-0867-EB11-84DD-A81E8446D5B0',2,N'F18F8F21-4265-EB11-84DD-A81E8446D5B0',0)
 ,(N'CCC621A8-0867-EB11-84DD-A81E8446D5B0',2,N'F54A3013-3866-EB11-84DD-A81E8446D5B0',0)
 ,(N'CEC621A8-0867-EB11-84DD-A81E8446D5B0',2,N'F54A3013-3866-EB11-84DD-A81E8446D5B0',0)
 ,(N'CFC621A8-0867-EB11-84DD-A81E8446D5B0',2,N'B5F47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'D3C621A8-0867-EB11-84DD-A81E8446D5B0',2,N'CFF47926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'D5C621A8-0867-EB11-84DD-A81E8446D5B0',2,N'D4F17926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'D6C621A8-0867-EB11-84DD-A81E8446D5B0',2,N'D6F17926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'DBC621A8-0867-EB11-84DD-A81E8446D5B0',2,N'3BF67926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'DDC621A8-0867-EB11-84DD-A81E8446D5B0',2,N'38F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'DEC621A8-0867-EB11-84DD-A81E8446D5B0',2,N'35F27926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'ADB7BA42-0B67-EB11-84DD-A81E8446D5B0',2,N'42F77926-9D61-EB11-84DC-A81E8446D5B0',0)
 ,(N'432CC058-426D-EB11-84E2-A81E8446D5B0',2,N'36C1E60F-ED66-EB11-84DD-A81E8446D5B0',0)
 ,(N'442CC058-426D-EB11-84E2-A81E8446D5B0',2,N'36C1E60F-ED66-EB11-84DD-A81E8446D5B0',0)
) AS [Source] ([index_guid],[index_column_id],[RepoObjectColumn_guid],[is_descending_key])
ON ([Target].[index_column_id] = [Source].[index_column_id] AND [Target].[index_guid] = [Source].[index_guid])
WHEN MATCHED AND (
	NULLIF([Source].[RepoObjectColumn_guid], [Target].[RepoObjectColumn_guid]) IS NOT NULL OR NULLIF([Target].[RepoObjectColumn_guid], [Source].[RepoObjectColumn_guid]) IS NOT NULL OR 
	NULLIF([Source].[is_descending_key], [Target].[is_descending_key]) IS NOT NULL OR NULLIF([Target].[is_descending_key], [Source].[is_descending_key]) IS NOT NULL) THEN
 UPDATE SET
  [Target].[RepoObjectColumn_guid] = [Source].[RepoObjectColumn_guid], 
  [Target].[is_descending_key] = [Source].[is_descending_key]
WHEN NOT MATCHED BY TARGET THEN
 INSERT([index_guid],[index_column_id],[RepoObjectColumn_guid],[is_descending_key])
 VALUES([Source].[index_guid],[Source].[index_column_id],[Source].[RepoObjectColumn_guid],[Source].[is_descending_key])
WHEN NOT MATCHED BY SOURCE THEN 
 DELETE;

DECLARE @mergeError int
 , @mergeCount int
SELECT @mergeError = @@ERROR, @mergeCount = @@ROWCOUNT
IF @mergeError != 0
 BEGIN
 PRINT 'ERROR OCCURRED IN MERGE FOR [repo].[IndexColumn_virtual]. Rows affected: ' + CAST(@mergeCount AS VARCHAR(100)); -- SQL should always return zero rows affected
 END
ELSE
 BEGIN
 PRINT '[repo].[IndexColumn_virtual] rows affected by MERGE: ' + CAST(@mergeCount AS VARCHAR(100));
 END
GO


SET NOCOUNT OFF
GO
